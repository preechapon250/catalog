# syntax=dhi.io/build:2-debian13

name: Firecrawl MCP Server 3.x
image: dhi.io/firecrawl-mcp
variant: runtime
tags:
  - "3"
  - "3.2"
  - 3.2.1
  - latest
  - 3-debian13
  - 3.2-debian13
  - 3.2.1-debian13
platforms:
  - linux/amd64
  - linux/arm64
vars:
  COMMIT_SHA: d22f144eee0754fd819b5b976b32294d8d234ea5
  NODE_BUILD_REFERENCE: dhi/node:24.13.0-debian13-sfw-dev@sha256:5260a0f14b48fd6bf44d7cef36c4e5eb0c7755afda29b272f1e705312dc14c18
  NODE_RUNTIME_REFERENCE: dhi/node:24.13.0-debian13@sha256:2f0ded1493cff1e093f1a4b82d678ac72aa9a9504da3054e4668cb71b486bc3f
  SEMVER_MAJOR_MINOR_VERSION: "3.2"
  SEMVER_MAJOR_VERSION: "3"
  SEMVER_VERSION: 3.2.1
  VERSION: 3.2.1
contents:
  packages:
    - '!base-files'
  builds:
    - name: firecrawl-mcp
      uses: dhi.io/node:24.13.0-debian13-sfw-dev@sha256:5260a0f14b48fd6bf44d7cef36c4e5eb0c7755afda29b272f1e705312dc14c18
      contents:
        files:
          - url: git+https://github.com/firecrawl/firecrawl-mcp-server.git#v3.2.1
            checksum: d22f144eee0754fd819b5b976b32294d8d234ea5
            path: ${source.dir}/firecrawl-mcp-d22f144eee0754fd819b5b976b32294d8d234ea5
            spdx:
              name: firecrawl-mcp
              version: 3.2.1
              packages:
                - name: firecrawl-mcp
                  purl: pkg:dhi/firecrawl-mcp@3.2.1
                  license: MIT
            uid: 0
            gid: 0
      pipeline:
        - name: bump dependencies
          uses: npm/bump@v1
          privileged: true
          environment:
            PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
          with:
            bumps: ${source.dir}/patch/npm-bump.json
            npm-root: ${source.dir}/firecrawl-mcp-d22f144eee0754fd819b5b976b32294d8d234ea5
        - name: install and build
          work-dir: ${source.dir}/firecrawl-mcp-d22f144eee0754fd819b5b976b32294d8d234ea5
          privileged: true
          runs: |
            set -eux -o pipefail

            npm ci --ignore-scripts
            npm run build
            rm -rf node_modules
            npm ci --omit=dev --ignore-scripts

            # Required because we are updating @modelcontextprotocol/sdk
            # See https://github.com/punkpeye/fastmcp/issues/208
            sed -i 's|this.#capabilities.logging = {};|this.#capabilities.logging = {};\n\tthis.#capabilities.completions = {};|g' \
              ${source.dir}/firecrawl-mcp-d22f144eee0754fd819b5b976b32294d8d234ea5/node_modules/firecrawl-fastmcp/dist/FastMCP.js
      paths:
        - type: file
          path: ${source.dir}/patch/npm-bump.json
          uid: 0
          gid: 0
          source: image/firecrawl-mcp/patch/npm-bump.json
      outputs:
        - source: ${source.dir}/firecrawl-mcp-d22f144eee0754fd819b5b976b32294d8d234ea5/node_modules
          target: /app/node_modules
          uid: 0
          gid: 0
        - source: ${source.dir}/firecrawl-mcp-d22f144eee0754fd819b5b976b32294d8d234ea5/dist
          target: /app/dist
          uid: 0
          gid: 0
        - source: /opt/docker/sbom/firecrawl-mcp
          target: /opt/docker/sbom/firecrawl-mcp
          uid: 0
          gid: 0
  artifacts:
    - name: dhi.io/node:24.13.0-debian13@sha256:2f0ded1493cff1e093f1a4b82d678ac72aa9a9504da3054e4668cb71b486bc3f
      uid: 0
      gid: 0
accounts:
  run-as: node
  users:
    - name: node
      uid: 1000
      gid: 1000
  groups:
    - name: node
      gid: 1000
      members:
        - node
os-release:
  name: Docker Hardened Images (Debian)
  id: debian
  version-id: "13"
  version-codename: trixie
  pretty-name: Docker Hardened Images/Debian GNU/Linux 13 (trixie)
  home-url: https://docker.com/products/hardened-images/
  bug-report-url: https://docker.com/support/
environment:
  FIRECRAWL_API_KEY: ""
annotations:
  org.opencontainers.image.description: Firecrawl MCP Server
  org.opencontainers.image.licenses: MIT
labels:
  io.modelcontextprotocol.server.name: io.firecrawl/firecrawl-mcp
entrypoint:
  - node
  - /app/dist/index.js
