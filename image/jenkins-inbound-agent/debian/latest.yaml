# syntax=dhi/build:1-debian13

# DO NOT EDIT THIS FILE MANUALLY
# generated with 'dhi def merge image/jenkins-inbound-agent/debian/latest.yaml'

name: Jenkins Inbound Agent (latest)
image: dhi/jenkins-inbound-agent
variant: runtime
tags:
    - "3345"
    - 3345-debian13
platforms:
    - linux/amd64
    - linux/arm64
vars:
    DOCKER_AGENT_COMMIT_SHA: a923d50a12dec5a3e00cada2ca3e254a2d2d26b7
    JAVA_HOME_PATH: /opt/java/openjdk/21-jre
    JAVA_MAJOR_VERSION: "21"
    JENKINS_AGENT_REF: dhi/jenkins-agent:3345-debian13@sha256:77384b25fbdd3abae08f223c3773f62409d6c1be9addf47417942a8139bc26fb
    REMOTING_COMMIT_SHA: 03dee9bf88fca2151e7f8f246c64fdacd72c62cb
    REMOTING_MAJOR_VERSION: "3345"
    REMOTING_VERSION: 3345.v03dee9b_f88fc
contents:
    packages:
        - '!libelogind0'
        - '!mawk'
        - '!original-awk'
        - base-files
        - bash
        - coreutils
    builds:
        - name: jenkins-inbound-agent
          contents:
            packages:
                - bash
                - coreutils
            files:
                - url: git+https://github.com/jenkinsci/docker-agent.git#a923d50a12dec5a3e00cada2ca3e254a2d2d26b7
                  checksum: a923d50a12dec5a3e00cada2ca3e254a2d2d26b7
                  path: ${source.dir}/docker-agent-a923d50a12dec5a3e00cada2ca3e254a2d2d26b7
                  spdx:
                    name: jenkins-docker-agent
                    version: 3345.v03dee9b_f88fc
                    packages:
                        - name: jenkins-docker-agent
                          purl: pkg:github/jenkinsci/docker-agent@a923d50a12dec5a3e00cada2ca3e254a2d2d26b7
                          license: MIT
                  uid: 0
                  gid: 0
          pipeline:
            - name: install-entrypoint-script
              work-dir: ${source.dir}/docker-agent-a923d50a12dec5a3e00cada2ca3e254a2d2d26b7
              runs: |
                set -eux -o pipefail

                mkdir -p "${target.dir}/usr/local/bin"
                install -m 0755 jenkins-agent "${target.dir}/usr/local/bin/jenkins-agent"
          outputs:
            - source: ${target.dir}/usr/local/bin/jenkins-agent
              target: /usr/local/bin/jenkins-agent
              uid: 0
              gid: 0
              mode: "0755"
        - name: locale
          uses: dhi/debian-base:trixie-debian13@sha256:c7651f9ef631e9a9feada59aff228f9382bdb537e85dc8e9c201093597898c45
          contents:
            packages:
                - bash
                - locales
                - coreutils
                - gzip
          pipeline:
            - name: install locales
              runs: |
                set -eux -o pipefail

                echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
                locale-gen en_US.UTF-8
          outputs:
            - source: /usr/share/locale
              target: /usr/share/locale
              uid: 0
              gid: 0
            - source: /usr/lib/locale
              target: /usr/lib/locale
              uid: 0
              gid: 0
    artifacts:
        - name: dhi/jenkins-agent:3345-debian13@sha256:77384b25fbdd3abae08f223c3773f62409d6c1be9addf47417942a8139bc26fb
          includes:
            - home/jenkins/**
            - opt/**
            - usr/local/bin/**
            - usr/share/jenkins/**
          uid: 0
          gid: 0
accounts:
    run-as: jenkins
    users:
        - name: jenkins
          uid: 1000
          gid: 1000
    groups:
        - name: jenkins
          gid: 1000
          members:
            - jenkins
os-release:
    name: Docker Hardened Images (Debian)
    id: debian
    version-id: "13"
    version-codename: trixie
    pretty-name: Docker Hardened Images/Debian GNU/Linux 13 (trixie)
    home-url: https://docker.com/products/hardened-images/
    bug-report-url: https://docker.com/support/
work-dir: /home/jenkins
environment:
    AGENT_WORKDIR: /home/jenkins/agent
    JAVA_HOME: /opt/java/openjdk/21-jre
    LANG: en_US.UTF-8
    LANGUAGE: en_US:en
    LC_ALL: en_US.UTF-8
    TZ: Etc/UTC
    USER: jenkins
paths:
    - type: directory
      path: /home/jenkins
      uid: 1000
      gid: 1000
      mode: "0755"
    - type: directory
      path: /home/jenkins/agent
      uid: 1000
      gid: 1000
      mode: "0755"
    - type: directory
      path: /home/jenkins/.jenkins
      uid: 1000
      gid: 1000
      mode: "0755"
annotations:
    org.opencontainers.image.description: A Jenkins Inbound Agent image for Kubernetes and containerized environments
    org.opencontainers.image.licenses: MIT
entrypoint:
    - /usr/local/bin/jenkins-agent
tests:
    - name: Run testcontainers tests
      directory: image/jenkins-inbound-agent/tests
      commands:
        - go test . -count=1 -v
      exit-code: 0
    - name: Run shared jenkins integration tests
      directory: ecosystem/jenkins/tests
      commands:
        - go test . -count=1 -v
      exit-code: 0
    - name: Run base tests
      directory: test/go-testing/base
      commands:
        - go test . -count=1 -v
      exit-code: 0
    - name: Run jenkins-agent tests
      directory: image/jenkins-agent/tests
      commands:
        - go test . -count=1 -v
      exit-code: 0
    - name: Run locales tests
      directory: test/go-testing/locales
      commands:
        - go test . -count=1 -v
      exit-code: 0
