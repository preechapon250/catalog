# syntax=dhi/build:1-debian13

# DO NOT EDIT THIS FILE MANUALLY
# generated with 'dhi def merge image/azul/debian/17-jdk-prime.yaml'

name: Azul Platform Prime 17.x
image: dhi/azul
variant: runtime
tags:
    - 17-jdk-prime
    - 17-jdk-prime-debian13
platforms:
    - linux/amd64
    - linux/arm64
dates:
    release: "2021-09-15"
    end-of-life: "2029-09-30"
vars:
    DHI_SKIP_PACKAGE_CHECK: "true"
    JAVA_MAJOR_VERSION: "17"
    JAVA_VERSION: 17.0.0
    VERSION: 25.12.0.0-3
contents:
    packages:
        - '!libelogind0'
        - '!mawk'
        - '!original-awk'
        - base-files
        - libc6
        - zlib1g
    builds:
        - name: azul
          contents:
            repositories:
                - deb [signed-by=/usr/share/keyrings/azul.gpg] https://repos.azul.com/zing/debian bookworm main
            keyring:
                - https://repos.azul.com/azul-repo.key
            packages:
                - bash
                - coreutils
                - findutils
                - zing-jdk17.0.0
            mappings:
                zing-jdk17.0.0: pkg:deb/azul/zing-jdk@17.0.0?os_name=debian&os_version=13
          pipeline:
            - name: install
              runs: |
                set -eux -o pipefail

                mkdir -p "${target.dir}/opt/zing"

                if [ -d "/usr/lib/jvm" ]; then
                  mv /usr/lib/jvm/zing* "${target.dir}/opt/zing"
                else
                  mv /opt/zing* "${target.dir}/opt"
                fi
                ZING_JDK_DIR=$(find "${target.dir}/opt/zing" -type d -name "zing-jdk*" -print)
                ZING_JDK_DIR_BASENAME=$(basename "${ZING_JDK_DIR}")
                ln -s "/opt/zing/${ZING_JDK_DIR_BASENAME}" "${target.dir}/opt/zing/zing-jdk17"
          outputs:
            - source: ${target.dir}/opt/zing
              target: /opt/zing
              uid: 0
              gid: 0
            - source: /opt/docker/sbom
              target: /opt/docker/sbom
              uid: 0
              gid: 0
        - name: locale
          uses: dhi/debian-base:trixie-debian13@sha256:c7651f9ef631e9a9feada59aff228f9382bdb537e85dc8e9c201093597898c45
          contents:
            packages:
                - bash
                - locales
                - coreutils
                - gzip
          pipeline:
            - name: install locales
              runs: |
                set -eux -o pipefail

                echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
                locale-gen en_US.UTF-8
          outputs:
            - source: /usr/share/locale
              target: /usr/share/locale
              uid: 0
              gid: 0
            - source: /usr/lib/locale
              target: /usr/lib/locale
              uid: 0
              gid: 0
accounts:
    run-as: nonroot
    users:
        - name: nonroot
          uid: 65532
          gid: 65532
    groups:
        - name: nonroot
          gid: 65532
          members:
            - nonroot
os-release:
    name: Docker Hardened Images (Debian)
    id: debian
    version-id: "13"
    version-codename: trixie
    pretty-name: Docker Hardened Images/Debian GNU/Linux 13 (trixie)
    home-url: https://docker.com/products/hardened-images/
    bug-report-url: https://docker.com/support/
environment:
    JAVA_HOME: /opt/zing/zing-jdk17
    LANG: en_US.UTF-8
    LANGUAGE: en_US:en
    LC_ALL: en_US.UTF-8
    PATH: /opt/zing/zing-jdk17/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
annotations:
    org.opencontainers.image.description: A minimal Azul Platform Prime image
cmd:
    - java
    - --help
tests:
    - name: Run testcontainers tests
      directory: image/azul/tests
      commands:
        - go test . -count=1 -v
      exit-code: 0
    - name: Run testcontainers basic tests
      directory: test/go-testing/base
      commands:
        - go test . -count=1 -v
      exit-code: 0
    - name: Run locales tests
      directory: test/go-testing/locales
      commands:
        - go test . -count=1 -v
      exit-code: 0
