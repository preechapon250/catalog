# syntax=dhi.io/build:2-debian13

name: Logstash 9.2.x
image: dhi.io/logstash
variant: runtime
tags:
  - "9"
  - "9.2"
  - 9.2.4
  - 9-debian13
  - 9.2-debian13
  - 9.2.4-debian13
platforms:
  - linux/amd64
  - linux/arm64
dates:
  release: "2025-10-21"
vars:
  ARCH: '#{ target.arch == "amd64" ? "x86_64" : "aarch64" }'
  COMMIT_SHA: a8e90a3721f01ba577f1a12c6a350b8b58b74f8c
  GO_REFERENCE: dhi/golang:1.24.12-debian13-dev@sha256:0321bd51a66050dec733d26d791377273598a4f5078d70a0b8a47633af01f55b
  GO_VERSION: 1.24.12
  GRADLE_REFERENCE: dhi/gradle:8.14.4-jdk21-debian13-dev@sha256:b7515b79699529fbcdb7e1229e7bd1af2a86c664bceea21521c9ab026c12688c
  GRADLE_VERSION: 8.14.4
  JAVA_MAJOR_VERSION: "21"
  JDK_REFERENCE: dhi/eclipse-temurin:21.0.9.10-jdk-debian13-dev@sha256:ed528dbe9717e6ce59d1e534905137119f549778e3cb16f76b9eb9a5e296ec5b
  JDK_VERSION: 21.0.9.10
  LOGSTASH_PATH: /usr/share/logstash
  LOGSTASH_SOURCE: "1"
  OSS: "true"
  SEMVER_MAJOR_MINOR_VERSION: "9.2"
  SEMVER_MAJOR_VERSION: "9"
  SEMVER_VERSION: 9.2.4
  VERSION: 9.2.4
contents:
  packages:
    - '!libelogind0'
    - '!mawk'
    - '!original-awk'
    - base-files
    - bash
    - coreutils
    - sed
  builds:
    - name: env2yaml java for 8.19+
      uses: dhi.io/gradle:8.14.4-jdk21-debian13-dev@sha256:b7515b79699529fbcdb7e1229e7bd1af2a86c664bceea21521c9ab026c12688c
      contents:
        packages:
          - bash
          - coreutils
        files:
          - url: git+https://github.com/elastic/logstash.git#a8e90a3721f01ba577f1a12c6a350b8b58b74f8c
            checksum: a8e90a3721f01ba577f1a12c6a350b8b58b74f8c
            path: ${source.dir}/logstash
            uid: 0
            gid: 0
      pipeline:
        - name: build env2yaml java
          work-dir: ${source.dir}/logstash/docker/data/logstash/env2yaml
          privileged: true
          runs: |
            set -eux -o pipefail

            gradle build
      outputs:
        - source: ${source.dir}/logstash/docker/data/logstash/env2yaml
          target: /usr/share/logstash/env2yaml
          uid: 0
          gid: 0
          mode: "0755"
        - source: ${source.dir}/logstash/docker/data/logstash/env2yaml/env2yaml
          target: /usr/local/bin/env2yaml
          uid: 0
          gid: 0
          mode: "0755"
    - name: build logstash
      uses: dhi.io/gradle:8.14.4-jdk21-debian13-dev@sha256:b7515b79699529fbcdb7e1229e7bd1af2a86c664bceea21521c9ab026c12688c
      contents:
        packages:
          - coreutils
          - curl
          - findutils
          - grep
          - gzip
          - libc6-dev
          - make
          - sed
          - tar
        files:
          - url: git+https://github.com/elastic/logstash.git#v9.2.4
            checksum: a8e90a3721f01ba577f1a12c6a350b8b58b74f8c
            path: ${source.dir}/logstash
            spdx:
              name: logstash
              version: 9.2.4
              packages:
                - name: logstash
                  purl: pkg:dhi/logstash@9.2.4
                  license: Apache-2.0
            uid: 0
            gid: 0
          - url: https://repo1.maven.org/maven2/at/yawk/lz4/lz4-java/1.10.1/lz4-java-1.10.1.jar
            path: ${source.dir}/patch/deps/lz4-java-1.10.1.jar
            uid: 0
            gid: 0
      pipeline:
        - name: patch deps
          uses: git/patch@v1
          work-dir: ${source.dir}/logstash
          with:
            patch: ${source.dir}/patch/deps-9.2.patch
        - name: install default gems
          work-dir: ${source.dir}/logstash
          privileged: true
          runs: |
            set -eux -o pipefail

            gradle installDefaultGems
        - name: install assemble tar distro
          work-dir: ${source.dir}/logstash
          privileged: true
          runs: |
            set -eux -o pipefail

            gradle assembleOssTarDistribution
        - name: unpack
          work-dir: ${source.dir}/logstash
          runs: |
            set -eux -o pipefail

            tar -zxf "build/logstash-oss-9.2.4-SNAPSHOT-no-jdk.tar.gz" -C /usr/share

            mkdir -p "${target.dir}/usr/share/logstash"

            cp -r "/usr/share/logstash-9.2.4"-SNAPSHOT/* "${target.dir}/usr/share/logstash"
      paths:
        - type: directory
          path: ${source.dir}/patch
          uid: 0
          gid: 0
          source: image/logstash/patch
      outputs:
        - source: ${target.dir}/usr/share/logstash
          target: /usr/share/logstash
          uid: 0
          gid: 0
          mode: "0755"
        - source: /opt/docker/sbom/logstash
          target: /opt/docker/sbom/logstash
          uid: 0
          gid: 0
        - source: ${source.dir}/logstash/docker/data/logstash/bin/docker-entrypoint
          target: /usr/local/bin/docker-entrypoint
          uid: 0
          gid: 0
          mode: "0755"
        - source: ${source.dir}/logstash/docker/data/logstash/config/pipelines.yml
          target: /usr/share/logstash/config/pipelines.yml
          uid: 1000
          gid: 0
          mode: "0644"
        - source: ${source.dir}/logstash/docker/data/logstash/config/log4j2.properties
          target: /usr/share/logstash/config/log4j2.properties
          uid: 1000
          gid: 0
          mode: "0644"
        - source: ${source.dir}/logstash/docker/data/logstash/config/log4j2.file.properties
          target: /usr/share/logstash/config/log4j2.file.properties
          uid: 1000
          gid: 0
          mode: "0644"
        - source: ${source.dir}/logstash/docker/data/logstash/config/logstash-oss.yml
          target: /usr/share/logstash/config/logstash.yml
          uid: 1000
          gid: 0
          mode: "0644"
        - source: ${source.dir}/logstash/docker/data/logstash/pipeline/default.conf
          target: /usr/share/logstash/pipeline/logstash.conf
          uid: 1000
          gid: 0
          mode: "0644"
  artifacts:
    - name: dhi.io/eclipse-temurin:21.0.9.10-jdk-debian13-dev@sha256:ed528dbe9717e6ce59d1e534905137119f549778e3cb16f76b9eb9a5e296ec5b
      includes:
        - opt/**
        - usr/local/bin/**
      uid: 0
      gid: 0
accounts:
  run-as: logstash
  users:
    - name: logstash
      uid: 1000
      gid: 1000
  groups:
    - name: logstash
      gid: 1000
      members:
        - logstash
os-release:
  name: Docker Hardened Images (Debian)
  id: debian
  version-id: "13"
  version-codename: trixie
  pretty-name: Docker Hardened Images/Debian GNU/Linux 13 (trixie)
  home-url: https://docker.com/products/hardened-images/
  bug-report-url: https://docker.com/support/
work-dir: /usr/share/logstash
environment:
  ELASTIC_CONTAINER: "true"
  PATH: /usr/share/logstash/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
paths:
  - type: directory
    path: /usr/share/logstash
    uid: 0
    gid: 0
    mode: "0755"
  - type: directory
    path: /usr/share/logstash/data
    uid: 1000
    gid: 0
    mode: "2755"
  - type: directory
    path: /usr/share/logstash/logs
    uid: 1000
    gid: 0
    mode: "2755"
  - type: symlink
    path: /opt/logstash
    uid: 0
    gid: 0
    source: /usr/share/logstash
  - type: symlink
    path: /usr/share/logstash/jdk
    uid: 0
    gid: 0
    source: /opt/java/openjdk/21
annotations:
  org.opencontainers.image.description: A minimal logstash image
  org.opencontainers.image.licenses: Elastic-License-2.0
entrypoint:
  - /usr/local/bin/docker-entrypoint
ports:
  - 9600/tcp
  - 5044/tcp
