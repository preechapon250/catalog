# syntax=dhi/build:1-debian13

# DO NOT EDIT THIS FILE MANUALLY
# generated with 'dhi def merge image/git-mcp/debian/0.yaml'

name: Git MCP Server 2025.x
image: dhi/git-mcp
variant: runtime
tags:
    - "2025"
    - latest
    - "2025.11"
    - 2025.11.25
    - 2025-debian13
    - 2025.11-debian13
    - 2025.11.25-debian13
platforms:
    - linux/amd64
    - linux/arm64
vars:
    ARCH: '#{ target.arch == "amd64" ? "x86_64" : "aarch64" }'
    COMMIT_SHA: 0155af3069fb6d593165037a28703cb3a595cf67
    PYTHON_DEV_REFERENCE: dhi/python:3.14.2-debian13-sfw-dev@sha256:fdc248d42119bcd448b5e6465a86bba9713b08953417bf8ca592574257a1d41c
    PYTHON_REFERENCE: dhi/python:3.14.2-debian13@sha256:dde511d46cd4a45ec18794a219b20f660a8756bacb0b2d48e09b262a37b527c6
    SEMVER_MAJOR_MINOR_VERSION: "2025.11"
    SEMVER_MAJOR_VERSION: "2025"
    SEMVER_VERSION: 2025.11.25
    UV_VERSION: 0.9.18
    VERSION: 2025.11.25
contents:
    packages:
        - base-files
        - git
    builds:
        - name: git-mcp
          uses: dhi/python:3.14.2-debian13-sfw-dev@sha256:fdc248d42119bcd448b5e6465a86bba9713b08953417bf8ca592574257a1d41c
          environment:
            UV_COMPILE_BYTECODE: "1"
          contents:
            packages:
                - gzip
                - tar
            files:
                - url: https://github.com/astral-sh/uv/releases/download/0.9.18/uv-${ARCH}-unknown-linux-gnu.tar.gz
                  path: ${source.dir}/uv-unknown-linux-gnu.tar.gz
                  uid: 0
                  gid: 0
                - url: git+https://github.com/modelcontextprotocol/servers.git#2025.11.25
                  checksum: 0155af3069fb6d593165037a28703cb3a595cf67
                  path: ${source.dir}/servers
                  spdx:
                    name: git-mcp
                    version: 2025.11.25
                    packages:
                        - name: git-mcp
                          purl: pkg:dhi/git-mcp@2025.11.25
                          license: MIT
                  uid: 0
                  gid: 0
          pipeline:
            - name: setup uv
              runs: |
                set -eux -o pipefail

                mkdir -p /usr/local/bin
                tar -xzf "${source.dir}/uv-unknown-linux-gnu.tar.gz" -C /usr/local/bin --strip-components=1
                chmod +x /usr/local/bin/uv
            - name: move to /app
              runs: |
                set -eux -o pipefail

                cp -r "${source.dir}/servers/src/git" /app
            - name: build python package
              work-dir: /app
              privileged: true
              runs: |
                set -eux -o pipefail

                rm .python-version

                sfw uv lock --upgrade
                sfw uv sync --locked --no-install-project --no-dev --no-editable
                sfw uv sync --locked --no-dev --no-editable
          outputs:
            - source: /app/.venv
              target: /app/.venv
              uid: 0
              gid: 0
            - source: /opt/docker/sbom/git-mcp
              target: /opt/docker/sbom/git-mcp
              uid: 0
              gid: 0
    artifacts:
        - name: dhi/python:3.14.2-debian13@sha256:dde511d46cd4a45ec18794a219b20f660a8756bacb0b2d48e09b262a37b527c6
          excludes:
            - etc/group
            - etc/passwd
            - etc/shadow
          uid: 0
          gid: 0
accounts:
    root: true
    run-as: nonroot
    users:
        - name: nonroot
          uid: 65532
          gid: 65532
    groups:
        - name: nonroot
          gid: 65532
          members:
            - nonroot
os-release:
    name: Docker Hardened Images (Debian)
    id: debian
    version-id: "13"
    version-codename: trixie
    pretty-name: Docker Hardened Images/Debian GNU/Linux 13 (trixie)
    home-url: https://docker.com/products/hardened-images/
    bug-report-url: https://docker.com/support/
environment:
    PATH: /app/.venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
paths:
    - type: file
      path: /home/nonroot/.gitconfig
      content: |
        [safe]
            directory = *
      uid: 65532
      gid: 65532
      mode: "0644"
    - type: file
      path: /root/.gitconfig
      content: |
        [safe]
            directory = *
      uid: 0
      gid: 0
      mode: "0644"
annotations:
    org.opencontainers.image.description: Git MCP Server
    org.opencontainers.image.licenses: MIT
labels:
    io.modelcontextprotocol.server.name: io.github.modelcontextprotocol/server-git
entrypoint:
    - mcp-server-git
tests:
    - name: Run testcontainers tests
      directory: image/git-mcp/tests
      commands:
        - go test . -count=1 -v
      exit-code: 0
