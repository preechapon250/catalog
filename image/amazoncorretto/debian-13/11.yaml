# syntax=dhi.io/build:2-debian13

name: Amazon Corretto 11.x
image: dhi.io/amazoncorretto
variant: runtime
tags:
  - "11"
  - "11.0"
  - 11.0.30
  - 11.0.30.7.1
  - 11-debian13
  - 11.0-debian13
  - 11.0.30-debian13
  - 11.0.30.7.1-debian13
platforms:
  - linux/amd64
  - linux/arm64
dates:
  release: "2019-02-18"
  end-of-life: "2032-01-31"
vars:
  ARCH: '#{ target.arch == "amd64" ? "x64" : "aarch64" }'
  BASE_VERSION: 11.0.30.7.1
  DEBIAN_REFERENCE: dhi/debian-base:trixie-debian13@sha256:1244523a2f7b6c096c6f98ce0349df6798c775c57322c51f8a4982daf60c256c
  JAVA_DST_BASENAME: java-11-amazon-corretto
  JAVA_HOME: /usr/lib/jvm/java-11-amazon-corretto
  JAVA_JDK_DOWNLOAD: https://corretto.aws/downloads/resources/11.0.30.7.1/amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz
  JAVA_JDK_SIG: https://corretto.aws/downloads/resources/11.0.30.7.1/amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz.sig
  JAVA_MAJOR_MINOR_VERSION: "11.0"
  JAVA_MAJOR_VERSION: "11"
  JAVA_SRC_BASENAME: amazon-corretto-11.0.30.7.1-linux-${ARCH}
  JAVA_VERSION: 11.0.30
  JAVA_VERSION_SUFFIX: "7.1"
  VERSION: 11.0.30.7.1
contents:
  packages:
    - '!acl'
    - '!bzip2'
    - '!cdebconf'
    - '!debconf'
    - '!dpkg'
    - '!gcc-14'
    - '!gcc-14-base'
    - '!gcc-base'
    - '!install-info'
    - '!libacl1'
    - '!libdebian-installer'
    - '!libdebian-installer4'
    - '!libelogind0'
    - '!libgcc-s1'
    - '!libnewt0.52'
    - '!libpcre2-8-0'
    - '!libreadline8t64'
    - '!libslang2'
    - '!libssl3t64'
    - '!libtextwrap'
    - '!libtextwrap1'
    - '!libtinfo6'
    - '!mawk'
    - '!openssl'
    - '!openssl-provider-legacy'
    - '!original-awk'
    - '!pcre2'
    - '!readline-common'
    - '!tar'
    - base-files
    - ca-certificates
    - locales
  builds:
    - name: amazoncorretto
      contents:
        packages:
          - base-files
          - bash
          - coreutils
          - findutils
          - gpg
          - gpg-agent
          - tar
          - gzip
        files:
          - url: https://corretto.aws/downloads/resources/11.0.30.7.1/amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz.sig
            path: ${source.dir}/amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz.sig
            uid: 0
            gid: 0
          - url: https://corretto.aws/downloads/resources/11.0.30.7.1/amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz
            path: ${source.dir}/amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz
            spdx:
              name: amazoncorretto
              version: 11.0.30.7.1
              packages:
                - name: amazoncorretto
                  purl: pkg:dhi/amazoncorretto@11.0.30.7.1
                  license: GPL-2.0-only WITH Classpath-exception-2.0
            uid: 0
            gid: 0
      pipeline:
        - name: verify signature
          runs: |
            set -eux -o pipefail

            GNUPGHOME="$(mktemp -d)"
            export GNUPGHOME
            cat >> amazoncorretto-gpg-key << EOF
            -----BEGIN PGP PUBLIC KEY BLOCK-----
            Version: GnuPG v2.0.22 (GNU/Linux)

            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
            vDs=
            =IM3I
            -----END PGP PUBLIC KEY BLOCK-----
            EOF
            gpg --import amazoncorretto-gpg-key
            gpg --batch --verify "amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz.sig" "amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz"
        - name: unzip and stage
          runs: |
            set -eux -o pipefail

            mkdir -p "$(dirname "${target.dir}/usr/lib/jvm/java-11-amazon-corretto")"
            tar -zxvf "amazon-corretto-11.0.30.7.1-linux-${ARCH}.tar.gz"
            mv "amazon-corretto-11.0.30.7.1-linux-${ARCH}" "${target.dir}/usr/lib/jvm/java-11-amazon-corretto"
            chown -R 0:0 "${target.dir}/usr/lib/jvm/java-11-amazon-corretto"
        - name: create symlinks
          runs: |
            set -eux -o pipefail

            mkdir -p "${target.dir}/usr/bin"
            find "${target.dir}/usr/lib/jvm/java-11-amazon-corretto/bin" -type f -executable -o -type l | while read -r file; do
              filename="$(basename "$file")"
              ln -s "/usr/lib/jvm/java-11-amazon-corretto/bin/$filename" "${target.dir}/usr/bin/$filename"
            done
      outputs:
        - source: ${target.dir}/usr/lib/jvm/java-11-amazon-corretto
          target: /usr/lib/jvm/java-11-amazon-corretto
          uid: 0
          gid: 0
        - source: ${target.dir}/usr/bin
          target: /usr/bin
          uid: 0
          gid: 0
        - source: /opt/docker/sbom
          target: /opt/docker/sbom
          uid: 0
          gid: 0
    - name: locale
      uses: dhi.io/debian-base:trixie-debian13@sha256:1244523a2f7b6c096c6f98ce0349df6798c775c57322c51f8a4982daf60c256c
      contents:
        packages:
          - bash
          - locales
          - coreutils
          - gzip
      pipeline:
        - name: install locales
          runs: |
            set -eux -o pipefail

            ln -s /etc/locale.alias /usr/share/locale/locale.alias

            echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
            locale-gen en_US.UTF-8
      outputs:
        - source: /usr/share/locale
          target: /usr/share/locale
          uid: 0
          gid: 0
        - source: /usr/lib/locale
          target: /usr/lib/locale
          uid: 0
          gid: 0
accounts:
  run-as: nonroot
  users:
    - name: nonroot
      uid: 65532
      gid: 65532
  groups:
    - name: nonroot
      gid: 65532
      members:
        - nonroot
os-release:
  name: Docker Hardened Images (Debian)
  id: debian
  version-id: "13"
  version-codename: trixie
  pretty-name: Docker Hardened Images/Debian GNU/Linux 13 (trixie)
  home-url: https://docker.com/products/hardened-images/
  bug-report-url: https://docker.com/support/
environment:
  JAVA_HOME: /usr/lib/jvm/java-11-amazon-corretto
  LANG: en_US.UTF-8
  LANGUAGE: en_US:en
  LC_ALL: en_US.UTF-8
annotations:
  org.opencontainers.image.description: The full Amazon Corretto JDK image
  org.opencontainers.image.licenses: GPL-2.0-only WITH Classpath-exception-2.0
cmd:
  - java
  - -help
